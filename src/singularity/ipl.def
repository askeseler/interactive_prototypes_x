Bootstrap: docker
From: nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04

  
%environment
  # The Anaconda environment needs to be available during execution
  export "PATH=/opt/conda/bin:$PATH"


%post
  ## install wget ##

  apt -y update
  apt -y install wget # to download miniconda

  ## Downloads and installs Miniconda3 ##

  wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh
  chmod +x ~/miniconda.sh
  ~/miniconda.sh -b -p /opt/conda
  rm ~/miniconda.sh
  export "PATH=/opt/conda/bin:$PATH"


  ## Install python version of my workstation ##

  conda install --yes python==3.7.10 


  ## install exact pytorch and torchvision versions used on my workstation ##

  conda install pytorch=1.7.1=py3.7_cuda10.1.243_cudnn7.6.3_0 -c pytorch
  conda install torchvision=0.8.2=py37_cu101 -c pytorch


  ## Install other python packages ##

  conda install numpy
  conda install pandas 
  conda install tqdm 
  conda install pillow 
  conda install opencv # does not work for python 3.8
  conda install matplotlib
  conda install -c anaconda scikit-learn
  conda install -c conda-forge pytorch-lightning=1.5.6

  ## install pip3 and tensorboard ##

  apt-get install --no-install-recommends --assume-yes python3-pip
  pip3 install tensorboard
  
  apt-get install -y unzip
  apt install -y python3-pip
  pip install gdown 
  mkdir /opt/datasets/


%runscript
  cd /opt/datasets/
  gdown --id 1DdNsoPv6fCE-nhlK68ceVG3RFo28tk4W
  unzip cub200.zip
  rm cub200.zip
  cd ~/interactive_prototypes_x/src/experiments
  python experiments_main.py --dataset "/opt/datasets/cub200/images/" $@
